---
name: data-security-protocol
description: Критический протокол защиты данных. Запрещает удаление, порчу или перезапись базы товаров и файлов изображений. Обязателен к ознакомлению перед любыми работами с данными.
---

# Data Security Protocol (Протокол безопасности данных)

Этот документ гарантирует сохранность накопленной базы знаний проекта Wayy. Любое нарушение этого протокола приведет к потере критически важных данных (товаров и картинок), что недопустимо.

## 1. Неприкосновенные файлы (READ-ONLY / APPEND-ONLY)

Следующие файлы и директории защищены от удаления и полной перезаписи:

### 1.1 База товаров (JSON)
*   **Файл**: `public/centrifuges.json` (или любой другой JSON с товарами).
*   **Правило**: ЗАПРЕЩЕНО удалять этот файл или перезаписывать его пустым массивом.
*   **Разрешено**: Добавлять новые объекты в массив (`push`). Обновлять поля существующих товаров (только при явной необходимости).
*   **Запрещено**: Делать `products = []` или фильтровать массив с удалением элементов без 100% уверенности и бэкапа.

### 1.2 Исходный код данных
*   **Файл**: `lib/data.ts`.
*   **Правило**: Этот файл содержит структуру и логику загрузки. Нельзя менять типы данных (`Product`, `Subcategory`) так, чтобы они ломали совместимость с JSON-файлом.

### 1.3 Изображения
*   **Директория**: `public/napcep-images/` (и любые подпапки с фото товаров).
*   **Правило**: ЗАПРЕЩЕНО удалять файлы изображений. Скрипты очистки "ненужных" файлов запрещены без явного приказа.
*   **Риск**: Если удалить картинку, товар на сайте станет "слепым". Восстановить фото парсингом заново — долго и сложно.

## 2. Протокол работы со скриптами парсинга

При создании или изменении скриптов в папке `scripts/`:

1.  **Бэкап перед запуском**: Перед запуском скрипта, который пишет в `centrifuges.json`, ОБЯЗАТЕЛЬНО создай копию текущего файла (например, `centrifuges_backup_DATE.json`).
2.  **Режим добавления**: Скрипты должны проверять существование товара по ID или Name. Если товар уже есть — пропускаем или аккуратно обновляем. Если нет — добавляем. Нельзя перезаписывать весь файл "с нуля".
3.  **Валидация JSON**: Перед сохранением файла скрипт должен проверить, что JSON валиден и не пуст.

## 3. Защита от дубликатов (Safe Deduping)

Если нужно удалить дубликаты:
1.  **Алгоритм**: Сравнение должно быть мягким (trim, lovercase).
2.  **Проверка**: Перед удалением скрипт должен вывести в консоль: "Найдено X дубликатов. Удаляю...".
3.  **Никакого автоматического "чистого листа"**: Нельзя делать `products = unique(products)` одной строкой без проверок.

## 4. Чек-лист перед любым изменением данных
1.  [ ] Я делаю бэкап `public/centrifuges.json`?
2.  [ ] Я точно только добавляю данные, а не затираю старые?
3.  [ ] Я не трогаю папку с картинками?
4.  [ ] Если я меняю структуру JSON, совместима ли она с `lib/data.ts`?

---
**Метка времени фиксации**: 2026-02-17 17:00
